---

- name: Create chr users
  community.routeros.command:
    commands: >-
      user add name={{ item.name }} password={{ item.password | default(chr_default_user_password) }}
      group={{ item.group | default('read') }} comment="Ansible managed"
  register: result_create_user
#  no_log: true
  changed_when: result_create_user.stdout | regex_search('user with the same name already exists') is none
  failed_when: ( result_create_user.stdout | regex_search('expected end of command') is not none ) or
      ( result_create_user.stdout | regex_search('syntax error') is not none )
  tags: create_user
